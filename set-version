#!/bin/sh
#
# This file is distributed under the terms of the MIT License.
# See the LICENSE file at the top of this tree, or if it is missing a copy can
# be found at http://opensource.org/licenses/MIT
#
# Set the version number

dir=$(dirname $0)
cd "${dir}"

project="FreeRTOS-test"
version="$1"
copyright="(c) 2014 Chris Luke"

if [ -z "$version" ]; then
	echo "ERROR: Need a version string on the command line!"
	exit 1
fi

cat <<EOT >include/version.h
/** AUTOGENERATED FILE! DO NOT EDIT MANUALLY!
 * \file include/version.h
 *
 * \author Chris Luke <chrisy@flirble.org>
 * \copyright Copyright (c) Chris Luke <chrisy@flirble.org>
 *
 * \copyright This file is distributed under the terms of the MIT License.
 * See the LICENSE file at the top of this tree, or if it is missing a copy can
 * be found at http://opensource.org/licenses/MIT
 */

#ifndef _VERSION_H
#define _VERSION_H

#define PROJECT_NAME "${project}"
#define PROJECT_VERSION "${version}"
#define PROJECT_COPYRIGHT "${copyright}"

#endif /* _VERSION_H */
EOT

sed -i \
	-e "s/^AC_INIT.*$/AC_INIT([${project}], [${version}])/" \
	-e "s/^AC_COPYRIGHT.*$/AC_COPYRIGHT([${copyright}])/" \
	configure.ac

